<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PowerVR AI</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#0d0d0d;color:#fff;display:flex;overflow:hidden;height:100vh;}

.sidebar{
    width:260px;background:#150000;border-right:2px solid #900;padding:14px;
    flex-shrink:0;display:flex;flex-direction:column;transition:.3s;z-index:20;
}
.sidebar.hidden{transform:translateX(-100%);}
.sidebar h2{text-align:center;color:#ff3b3b;margin-bottom:14px;font-weight:600;}
.history{flex:1;overflow-y:auto;}
.history button{
    width:100%;padding:11px;background:#2b0000;color:#ff6b6b;
    border:none;border-radius:8px;text-align:left;margin-bottom:8px;
}

.toggle-btn{
    position:absolute;top:10px;left:10px;background:#900;border:none;
    width:45px;height:45px;border-radius:10px;color:white;font-size:22px;z-index:30;
}

.chat-container{
    flex:1;display:flex;flex-direction:column;position:relative;padding-top:52px;
}
.header{
    position:absolute;top:0;width:100%;padding:14px 0;
    text-align:center;background:#160000;border-bottom:2px solid #900;
    color:#ff3b3b;font-size:20px;font-weight:600;letter-spacing:1px;
}

.messages{
    flex:1;overflow-y:auto;padding:16px;
}
.msg-wrap{display:flex;margin:12px 0;align-items:flex-start;gap:10px;animation:fade .3s;}
@keyframes fade{from{opacity:0;transform:translateY(8px);}to{opacity:1;}}
.avatar{
    width:44px;height:44px;border-radius:50%;background-size:cover;background-position:center;
    border:2px solid #900;flex-shrink:0;
}
.msg{
    max-width:75%;padding:12px 14px;border-radius:12px;font-size:15px;line-height:1.42;
}
.bot{background:#210000;border:1px solid #900;}
.user{background:#b30000;margin-left:auto;}

.input-area{display:flex;gap:8px;padding:10px;background:#160000;border-top:2px solid #900;}
input{
    flex:1;padding:13px;border:none;border-radius:10px;background:#200;color:white;
    font-size:16px;
}
.send, .mic{
    width:49px;background:#b30000;border:none;border-radius:10px;color:white;font-size:18px;
}

@media(max-width:850px){
    .sidebar{position:absolute;height:100%;}
}
</style>
</head>
<body>

<button class="toggle-btn" onclick="toggleSidebar()">â˜°</button>

<div class="sidebar hidden" id="sidebar">
    <h2>Riwayat Chat</h2>
    <div class="history" id="history"></div>
</div>

<div class="chat-container">
    <div class="header">âš¡ PowerVR AI âš¡</div>
    <div class="messages" id="chat"></div>

    <div class="input-area">
        <button class="mic" onclick="recordAudio()">ðŸŽ¤</button>
        <input type="text" id="input" placeholder="Ketik pesan...">
        <button class="send" onclick="sendMsg()">âž¤</button>
    </div>
</div>

<audio id="glitch" src="https://files.catbox.moe/oojo6j.mp3" preload="auto"></audio>

<script>
let apiKey = "AIzaSyBh2qu_tZ4uYhSgP4H9S5hKorXe0BZsbuU"; // ganti
let sidebar = document.getElementById("sidebar");
let chat = document.getElementById("chat");
let historyEl = document.getElementById("history");
let historyList = [];
let recording = false;
let mediaRecorder, audioChunks = [];

const SYSTEM_PROMPT = `
Kamu adalah PowerVR AI â€” karakter badas, vibes gelap, cerdas,
jawab santai tapi tegas, sedikit sinis tapi sopan, gak cringe, gak formal kaku.
Tugasmu bantu user dengan efisien namun gaya cool, confident, dan dominan.
`;

// avatar AI cyber iblis neon
const AI_AVATAR = "https://files.catbox.moe/nh2fk3.png";
const USER_AVATAR = "https://files.catbox.moe/3pu9mx.png";

function toggleSidebar(){ sidebar.classList.toggle("hidden"); }

function addChat(text, sender){
    let wrap = document.createElement("div");
    wrap.className = "msg-wrap";

    let avatar = document.createElement("div");
    avatar.className = "avatar";
    avatar.style.backgroundImage = `url(${sender === "bot" ? AI_AVATAR : USER_AVATAR})`;

    let msg = document.createElement("div");
    msg.className = "msg " + sender;
    msg.innerText = text;

    wrap.appendChild(avatar);
    wrap.appendChild(msg);

    if(sender === "user") wrap.style.justifyContent = "flex-end";
    chat.appendChild(wrap);
    chat.scrollTop = chat.scrollHeight;

    if(sender === "bot") navigator.vibrate?.(20);
}

async function typingEffect(text){
    const sound = document.getElementById("glitch");
    let output = "";
    for(let i = 0; i < text.length; i++){
        output += text[i];
        if(i % 2 === 0) sound.play();
        chat.lastChild.querySelector(".msg").innerText = output;
        chat.scrollTop = chat.scrollHeight;
        await new Promise(r=>setTimeout(r,18));
    }
}

async function sendMsg(){
    let msg = document.getElementById("input").value.trim();
    if(!msg) return;

    addChat(msg, "user");
    document.getElementById("input").value = "";

    historyList.push(msg);
    historyEl.innerHTML += `<button onclick="loadHistory('${msg}')">${msg.slice(0,25)}...</button>`;

    let botHolder = document.createElement("div");
    botHolder.className = "msg-wrap";
    botHolder.innerHTML = `
        <div class="avatar" style="background-image:url('${AI_AVATAR}')"></div>
        <div class="msg bot"></div>
    `;
    chat.appendChild(botHolder);

    let response = await fetch("https://api.deepseek.com/chat/completions",{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+apiKey
        },
        body:JSON.stringify({
            model:"deepseek-chat",
            messages:[
                {role:"system", content:SYSTEM_PROMPT},
                {role:"user", content:msg}
            ]
        })
    });

    let result = await response.json();
    let reply = result.choices[0].message.content;

    typingEffect(reply);
}

function loadHistory(msg){
    document.getElementById("input").value = msg;
    toggleSidebar();
}

// VOICE INPUT
async function recordAudio(){
    if(recording) return;
    recording = true;
    navigator.vibrate?.(50);

    let stream = await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();
    audioChunks = [];

    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = async ()=>{
        let blob = new Blob(audioChunks,{type:"audio/wav"});
        let reader = new FileReader();
        reader.onload = ()=>{ document.getElementById("input").value = "[Voice] " };
        reader.readAsDataURL(blob);
    };

    setTimeout(()=>{
        mediaRecorder.stop();
        recording = false;
    },3000);
}
</script>

</body>
  </html>
