<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PowerVR AI Chat</title>
<style>
body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    padding: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background-color: #343541;
    color: #ffffff;
}
header {
    padding: 15px;
    text-align: center;
    font-size: 24px;
    background-color: #444654;
    font-weight: bold;
}
#chat {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.message {
    max-width: 75%;
    padding: 10px 15px;
    border-radius: 12px;
    word-wrap: break-word;
}
.user { 
    background-color: #10a37f;
    align-self: flex-end;
    border-bottom-right-radius: 0;
}
.ai { 
    background-color: #444654;
    align-self: flex-start;
    border-bottom-left-radius: 0;
}
#input-container {
    display: flex;
    padding: 10px;
    background-color: #444654;
    gap: 10px;
}
#prompt {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: none;
    outline: none;
    background-color: #303134;
    color: white;
}
button {
    padding: 0 20px;
    border-radius: 8px;
    border: none;
    background-color: #10a37f;
    color: white;
    cursor: pointer;
}
button:hover { opacity: 0.9; }
.typing { font-style: italic; opacity: 0.7; }
</style>
</head>
<body>

<header>PowerVR AI Chat</header>
<div id="chat"></div>

<div id="input-container">
    <input type="text" id="prompt" placeholder="Ketik pertanyaanmu...">
    <button onclick="sendMessage()">Kirim</button>
</div>

<script>
let chatHistory = [];

function addMessage(content, sender, typing=false){
    const chat = document.getElementById("chat");
    const div = document.createElement("div");
    div.classList.add("message", sender);
    if(typing) div.classList.add("typing");
    div.innerText = content;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    return div;
}

async function sendMessage(){
    const promptInput = document.getElementById("prompt");
    const prompt = promptInput.value.trim();
    if(!prompt) return;

    addMessage(prompt, "user");
    promptInput.value = "";
    const typingDiv = addMessage("AI mengetik...", "ai", true);

    try{
        const res = await fetch("/api/chat", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ prompt, history: chatHistory })
        });
        const data = await res.json();
        chatHistory.push({ role:"user", content:prompt });
        chatHistory.push({ role:"assistant", content:data.reply });

        typingDiv.remove();
        addMessage(data.reply, "ai");
    } catch(e){
        typingDiv.innerText = "Error: " + e.message;
    }
}
</script>

</body>
</html>